# @bagaking/dma-frame è®¾è®¡æ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

åŸºäºç¬¬ä¸€æ€§åŸç†ï¼Œä¸ºæ–‡æ¡£å°ç»„ä»¶æä¾›æç®€è€Œå¼ºå¤§çš„é«˜åº¦æ§åˆ¶èƒ½åŠ›ã€‚ç»§æ‰¿åŸ AddOnFrameController çš„æ ¸å¿ƒç†å¿µï¼Œæ‰“é€ ç‹¬ç«‹ã€é€šç”¨çš„å¼€æºåŒ…ã€‚

## ğŸ¯ è®¾è®¡åŸåˆ™

### ç¬¬ä¸€æ€§åŸç†
1. **å•ä¸€çœŸç†æ¥æº**ï¼šåªæœ‰ä¸€ä¸ªé«˜åº¦çŠ¶æ€ï¼Œä¸€ä¸ªè°ƒæ•´å…¥å£
2. **ç«‹å³å“åº”**ï¼šå°ç»„ä»¶æ¨¡å¼åˆ‡æ¢ç«‹å³æ›´æ–°UI  
3. **åŸå­æ“ä½œ**ï¼šé«˜åº¦å˜åŒ–ä¸UIå˜åŒ–ç»‘å®šä¸ºå•ä¸ªäº‹åŠ¡
4. **ä¸²è¡ŒåŒ–**ï¼šBridge APIè°ƒç”¨ä¸¥æ ¼ä¸²è¡ŒåŒ–ï¼Œé¿å…ç«æ€æ¡ä»¶
5. **é›¶æŠ½è±¡è´Ÿæ‹…**ï¼šç§»é™¤æ‰€æœ‰ä¸å¿…è¦çš„ç®¡ç†å™¨å’Œé€‚é…å™¨

### ç”¨æˆ·ä½“éªŒ
- **è®¤çŸ¥è´Ÿæ‹…æœ€å°**ï¼šåªæœ‰ä¸‰ä¸ªå‚æ•°éœ€è¦ç†è§£
- **è¡Œä¸ºå¯é¢„æµ‹**ï¼šè°ƒç”¨å°±æ‰§è¡Œï¼Œæ— æ„å¤–è¡Œä¸º
- **é›¶å­¦ä¹ æˆæœ¬**ï¼šç›´è§‚çš„å‚æ•°å‘½å

## ğŸ¯ æ ¸å¿ƒè®¾è®¡ï¼šæç®€å•ä¸€æ¥å£

### å”¯ä¸€æ¥å£

æ¡†æ¶åªæä¾›ä¸€ä¸ªæ–¹æ³•ï¼š`adjustHeight(behavior)`

```typescript
interface HeightAdjustmentBehavior {
  targetHeight: number;        // ç›®æ ‡é«˜åº¦ï¼ˆè‡ªåŠ¨è¯†åˆ«fromï¼‰
  onUIChange: () => void;      // è§¦å‘ç»„ä»¶å†…UIå˜åŒ–çš„é’©å­
  onUIComplete?: () => Promise<void>; // æ£€æµ‹UIå˜åŒ–å®Œæˆçš„é’©å­ï¼ˆå¯é€‰ï¼‰
}

// ä½¿ç”¨
await controller.adjustHeight({
  targetHeight: 600,
  onUIChange: () => setCurrentHeight(600),
  onUIComplete: async () => await waitForAnimation()
});
```

## ğŸ—ï¸ å†…éƒ¨æ¶æ„

è™½ç„¶æ¥å£æç®€ï¼Œä½†å†…éƒ¨ä¿æŒå®Œæ•´ç³»ç»Ÿï¼š

### 1. æ—¶åºæ§åˆ¶ç³»ç»Ÿ
```
æ‰©å±•æ—¶åº (targetHeight > currentHeight)ï¼š
1. Bridge API å…ˆè°ƒç”¨ â†’ ç»„ä»¶è·å¾—ç©ºé—´
2. onUIChange() â†’ UIå¡«å……ç©ºé—´
3. onUIComplete() â†’ ç­‰å¾…å®Œæˆ

æ”¶ç¼©æ—¶åº (targetHeight < currentHeight)ï¼š
1. onUIChange() â†’ UIå…ˆæ”¶ç¼©
2. onUIComplete() â†’ ç­‰å¾…å®Œæˆ  
3. Bridge API åè°ƒç”¨ â†’ ç»„ä»¶è·Ÿéš
```

### 2. ä¸²è¡ŒåŒ–é˜Ÿåˆ—ç³»ç»Ÿ
- æ‰€æœ‰è°ƒç”¨è‡ªåŠ¨æ’é˜Ÿ
- ä¸¥æ ¼æŒ‰é¡ºåºæ‰§è¡Œ
- é˜²æ­¢å¹¶å‘å†²çª

### 3. å¹³å°æŠ½è±¡ç³»ç»Ÿ
```typescript
interface PlatformBridge {
  updateHeight(height: number): Promise<number>;
}
```

### 4. å®¹é”™ç³»ç»Ÿ
- Bridge API å¤±è´¥æ—¶UIçŠ¶æ€ä¿æŒä¸€è‡´
- è‡ªåŠ¨é™çº§å¤„ç†
- ä¸å›æ»šå·²å±•ç¤ºçš„ç•Œé¢

## ğŸ’¡ ç§»é™¤çš„å¤æ‚æ¦‚å¿µ

1. **âŒ ä¼˜å…ˆçº§ç³»ç»Ÿ**ï¼šä¸²è¡ŒåŒ–æ›´é‡è¦ï¼Œä¼˜å…ˆçº§å¢åŠ å¤æ‚åº¦
2. **âŒ çº¦æŸç³»ç»Ÿ**ï¼šäº¤ç»™åº”ç”¨å±‚å¤„ç†ï¼Œæ¡†æ¶ä¸åŒ…å«ä¸šåŠ¡æ¦‚å¿µ
3. **âŒ æ¡£ä½åˆ¶**ï¼šåº”ç”¨å±‚å…³æ³¨ç‚¹ï¼Œä¸å±äºæ¡†æ¶
4. **âŒ å¾®å°å˜åŒ–æ£€æµ‹**ï¼šæ¡†æ¶ä¸æ›¿ç”¨æˆ·åš"èªæ˜"åˆ¤æ–­
5. **âŒ å¤æ‚é…ç½®**ï¼šåªæœ‰å¿…è¦çš„å¹³å°æ¡¥æ¥é…ç½®
6. **âŒ å¤šç§è°ƒç”¨æ–¹å¼**ï¼šåªæœ‰ä¸€ä¸ªæ¥å£

## ğŸ¨ å®ç°è¦æ±‚

### æ ¸å¿ƒç±»ç»“æ„
```typescript
class CoreHeightController implements HeightController {
  private currentHeight = 0;
  private behaviorQueue: HeightAdjustmentBehavior[] = [];
  private executing = false;

  constructor(bridge: PlatformBridge, debug?: boolean) {}
  
  // å”¯ä¸€å…¬å…±æ¥å£
  async adjustHeight(behavior: HeightAdjustmentBehavior): Promise<void>
  
  // è¾…åŠ©æ–¹æ³•
  dispose(): void
  get isDisposed(): boolean
}
```

### åˆ›å»ºæ–¹å¼
```typescript
// é£ä¹¦å¹³å°ï¼ˆæœ€å¸¸ç”¨ï¼‰
const controller = await createFeishuHeightController();

// è‡ªå®šä¹‰å¹³å°
const controller = new CoreHeightController(customBridge);

// æµ‹è¯•ç¯å¢ƒ
const controller = createMockHeightController();
```

## ğŸ“¦ åŒ…ç»“æ„

ç®€æ´çš„æ–‡ä»¶ç»„ç»‡ï¼š
```
src/
â”œâ”€â”€ index.ts           # ä¸»è¦å¯¼å‡ºå’Œå·¥å‚å‡½æ•°
â”œâ”€â”€ HeightController.ts # æ ¸å¿ƒå®ç°
â”œâ”€â”€ FeishuBridge.ts    # é£ä¹¦å¹³å°é€‚é…å™¨
â””â”€â”€ types.ts           # ç±»å‹å®šä¹‰
```

## ğŸš€ å‘å¸ƒè®¡åˆ’

### v0.1.0 ç›®æ ‡
- [x] æ ¸å¿ƒ HeightController å®ç°
- [x] Feishu å¹³å°æ”¯æŒ
- [x] TypeScript å®Œæ•´ç±»å‹æ”¯æŒ
- [x] å·¥å‚å‡½æ•°å’Œä¾¿æ· API
- [ ] å®Œæ•´çš„æµ‹è¯•è¦†ç›–
- [ ] è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£

### å…¼å®¹æ€§ç­–ç•¥
- ä¸åŸ AddOnFrameController API å®Œå…¨å…¼å®¹
- æä¾› Legacy ç±»å‹åˆ«å (HeightBehavior)
- æ”¯æŒå¹³æ»‘è¿ç§»

## ğŸ¯ æˆåŠŸæ ‡å‡†

1. **API ç®€æ´æ€§**ï¼šåªéœ€è¦ç†è§£3ä¸ªå‚æ•°
2. **è¡Œä¸ºå¯é¢„æµ‹æ€§**ï¼šè°ƒç”¨è¡Œä¸ºä¸é¢„æœŸå®Œå…¨ä¸€è‡´
3. **å¹³å°å…¼å®¹æ€§**ï¼šæ”¯æŒ Feishu å¹¶å¯æ‰©å±•åˆ°å…¶ä»–å¹³å°
4. **æ€§èƒ½è¦æ±‚**ï¼šæ— æ€§èƒ½è´Ÿæ‹…ï¼Œä¸²è¡ŒåŒ–æ‰§è¡Œ
5. **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´çš„ TypeScript æ”¯æŒ

---

*åŸºäºç¬¬ä¸€æ€§åŸç†çš„ç»ˆæ€è®¾è®¡ï¼Œæ¶ˆé™¤ä¸€åˆ‡ä¸å¿…è¦çš„å¤æ‚åº¦ï¼Œä¸“æ³¨äºç”¨æˆ·çš„æœ¬è´¨éœ€æ±‚ã€‚*